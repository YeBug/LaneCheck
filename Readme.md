# 数据集处理说明

## 处理目标：自有数据集转换为Tusimple的公开数据集格式

### 自有数据集
```
roadData 
├── images      源图片 size_w * size_h
├── laneJSON    车道线标注JSON
└── roadJSON    可通行域标注JSON
```

### Tusimple数据集
```
Tusimple
├── train-set
│   ├── clips                   源图片 1280 * 720
│   ├── label_data_0313.json    tusimple标注格式JSON
│   ├── label_data_0531.json
│   └── label_data_0601.json
└── test-set
    ├── clips
    └── test_label.json

tusimple标注格式JSON-example：
{
    "lanes": [[-2, -2, -2, -2, 632, 625, 617, 609, 601, 594, 586, 578, 570, 563, 555, 547, 539, 532, 524, 516, 508, 501, 493, 485, 477, 469, 462, 454, 446, 438, 431, 423, 415, 407, 400, 392, 384, 376, 369, 361, 353, 345, 338, 330, 322, 314, 307, 299], [-2, -2, -2, -2, 719, 734, 748, 762, 777, 791, 805, 820, 834, 848, 863, 877, 891, 906, 920, 934, 949, 963, 978, 992, 1006, 1021, 1035, 1049, 1064, 1078, 1092, 1107, 1121, 1135, 1150, 1164, 1178, 1193, 1207, 1221, 1236, 1250, 1265, -2, -2, -2, -2, -2], [-2, -2, -2, -2, -2, 532, 503, 474, 445, 416, 387, 358, 329, 300, 271, 241, 212, 183, 154, 125, 96, 67, 38, 9, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2], [-2, -2, -2, 781, 822, 862, 903, 944, 984, 1025, 1066, 1107, 1147, 1188, 1229, 1269, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2]],
    "h_samples": [240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710], 
    "raw_file": "clips/0313-1/6040/20.jpg"
}
"lanes": 车道线与标准分割线交点的横坐标
"h_samples": 标准分割线纵坐标
"raw_file": 源图片路径
```

### 数据处理
1. 加载源数据标注json，解析各条线及其坐标
2. 设置阈值，筛除横向车道线
3. 对每条线分别处理与tusimple标准分割线的交点，每两个标注点与范围内的标准分割线利用相似三角形办法求交点横坐标，得到lanes
4. 添加h_samples与raw_file构造标准JSON

### 使用
1. 将image和标注JSON按格式排布，读取源图片的宽高
2. transToTusimple.py添加图片路径、JSON路径及输出label文件名
3. 填入图像宽高，执行训练-验证build或测试build


